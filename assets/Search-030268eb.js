import{v as k,x,r as $,b as L,o,d as m,w as B,e as g,f as i,u as p,i as P,t as V,g as d,q as _,z as b,c as h,A as C,B as D,F as j,k as z,j as H,a as N}from"./index-3dcebbb3.js";const T=k("search",{state:()=>({searchList:[],search:"",totalPages:1}),actions:{async getSearch(t=1){try{const a=await(await fetch(`https://api.themoviedb.org/3/search/multi?query=${this.search}&include_adult=false&language=ru&page=${t}`,x)).json();let s=a.results.filter(r=>r.poster_path!=null);this.totalPages=a.total_pages,t>1?this.searchList.push(...s):this.searchList=s}catch(e){console.log(e)}}}}),U={alt:"",class:"search__img"},q={class:"search__name"},A={__name:"SearchItem",props:{item:Object},setup(t){return(e,a)=>{const s=$("router-link"),r=L("lazy");return o(),m(s,{to:`/${t.item.media_type}/${t.item.id}`,class:"search__item"},{default:B(()=>[g(i("img",U,null,512),[[r,p(P)+t.item.poster_path]]),i("h3",q,V(t.item.title||t.item.name),1)]),_:1},8,["to"])}}},E={class:"container search"},F={class:"search__wrapper"},I={key:0,class:"loading"},M=i("div",{class:"loading__spiner"},null,-1),O=[M],R={__name:"Search",setup(t){const e=T();let a=null,s=d(1);const r=d(!1),f=_(()=>e.totalPages);async function v(){!r.value&&s.value<f.value&&(r.value=!0,s.value++,await e.getSearch(s.value),r.value=!1)}window.addEventListener("scroll",()=>{let c=window.scrollY+window.innerHeight>=document.body.clientHeight-footer.clientHeight;console.log(c),c&&v()});function y(c,l){a&&clearTimeout(a),a=setTimeout(()=>{c()},l)}let n=_({get:()=>e.search,set:c=>{e.search=c,y(e.getSearch,500)}});const w=_(()=>e.searchList);return b(()=>{e.search="",e.searchList=[]}),(c,l)=>(o(),h("div",E,[g(i("input",{"onUpdate:modelValue":l[0]||(l[0]=u=>D(n)?n.value=u:n=u),type:"text",class:"search__input",placeholder:"Найти фильм, сериал..."},null,512),[[C,p(n)]]),i("div",F,[(o(!0),h(j,null,z(w.value,(u,S)=>(o(),m(A,{key:S,item:u},null,8,["item"]))),128))]),r.value?(o(),h("div",I,O)):H("",!0)]))}},Y={class:"main"},J={__name:"Search",setup(t){return(e,a)=>(o(),h("main",Y,[N(R)]))}};export{J as default};
